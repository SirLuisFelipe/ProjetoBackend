openapi: 3.0.0
info:
  title: API do Projeto
  description: API para agendamento de horarios na pista de skate.
  version: 1.0.0
  contact:
    name: Luis Felipe Francisco
    email: lipalhos@gmail.com
servers:
  - url: reservation
    description: Ambiente atual

tags:
  - name: Auth Service
    description: Endpoints para autenticacao e cadastro de usuarios
  - name: Scheduling Service
    description: Endpoints para gestao de agendamentos
  - name: Scheduling Analytics
    description: Dados agregados de agendamentos para dashboards
  - name: User Service
    description: Endpoints para gestao de usuarios
  - name: Track Service
    description: Endpoints para gestao de pistas
  - name: Payment Service
    description: Endpoints para gestao de pagamento
    


components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    User:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        email:
          type: string
        cpf:
          type: string
        role:
          type: string
        encodedPassword:
          type: string

    UserRegisterDto:
      type: object
      properties:
        name:
          type: string
        email:
          type: string
        cpf:
          type: string
        password:
          type: string
        role:
          type: string

    UserEditDto:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        email:
          type: string
        cpf:
          type: string
        password:
          type: string
        role:
          type: string

    UserLoginDto:
      type: object
      properties:
        email:
          type: string
        password:
          type: string

    AuthResponseDto:
      type: object
      properties:
        user:
          $ref: '#/components/schemas/User'
        token:
          type: string

    Payment:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string

    Turno:
      type: string
      enum: [ MATUTINO, VESPERTINO, NOTURNO ]
      example: VESPERTINO

    CheckinStatus:
      type: string
      enum: [ PENDENTE, NAO_REALIZADO, REALIZADO, CANCELADO ]
      example: PENDENTE

    CreateSchedulingDto:
      type: object
      required:
        - userId
        - trackId
        - scheduledDate
        - turno
      properties:
        id:
          type: integer
          example: 10
          description: Usado apenas para update (PUT)
        userId:
          type: integer
          example: 1
        paymentId:
          type: integer
          nullable: true
          example: null
        trackId:
          type: integer
          example: 2
        scheduledDate:
          type: string
          format: date
          example: "2025-11-10"
        turno:
          $ref: '#/components/schemas/Turno'
        checkinStatus:
          allOf:
            - $ref: '#/components/schemas/CheckinStatus'
          description: >
            Campo opcional usado em respostas e pode ser enviado em atualizacoes para alterar o status.
            Regras: administradores so podem definir CANCELADO, REALIZADO ou NAO_REALIZADO; usuarios comuns so podem enviar CANCELADO ou REALIZADO (apenas no dia agendado). Se nao for alterar o status, omita este campo.

    Scheduling:
      type: object
      properties:
        id:
          type: integer
          example: 10
        user:
          $ref: '#/components/schemas/User'
        payment:
          $ref: '#/components/schemas/Payment'
          nullable: true
        track:
          $ref: '#/components/schemas/Track'
        scheduledDate:
          type: string
          format: date
          example: "2025-11-10"
        turno:
          $ref: '#/components/schemas/Turno'
        checkinStatus:
          $ref: '#/components/schemas/CheckinStatus'
    SchedulingTurnoSummary:
      type: object
      properties:
        turno:
          $ref: '#/components/schemas/Turno'
        total:
          type: integer
          format: int64
    SchedulingDaySummary:
      type: object
      properties:
        date:
          type: string
          format: date
        turnos:
          type: array
          items:
            $ref: '#/components/schemas/SchedulingTurnoSummary'
    SchedulingTrackSummary:
      type: object
      properties:
        trackId:
          type: integer
        trackName:
          type: string
        total:
          type: integer
          format: int64
    SchedulingPaymentSummary:
      type: object
      properties:
        paymentId:
          type: integer
          format: int64
          nullable: true
        paymentName:
          type: string
          nullable: true
        total:
          type: integer
          format: int64
    SchedulingUserSummary:
      type: object
      properties:
        userId:
          type: integer
          format: int64
        userName:
          type: string
        total:
          type: integer
          format: int64
    SchedulingTimelinePoint:
      type: object
      properties:
        period:
          type: string
          example: "2025-01"
        total:
          type: integer
          format: int64
    SchedulingCancellationStats:
      type: object
      properties:
        months:
          type: integer
        total:
          type: integer
          format: int64
        cancelled:
          type: integer
          format: int64
        percentage:
          type: number
          format: double

    Track:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string

paths:
  /auth/register:
    post:
      tags:
        - Auth Service
      summary: Registra um novo usuario
      operationId: registerUser
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserRegisterDto'
      responses:
        '200':
          description: Usuario registrado com sucesso
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponseDto'
        '500':
          description: Erro interno no servidor

  /auth/login:
    post:
      tags:
        - Auth Service
      summary: Autentica um usuario
      operationId: loginUser
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserLoginDto'
      responses:
        '200':
          description: Autenticacao realizada com sucesso
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponseDto'
        '500':
          description: Erro interno no servidor


  /scheduling/:
    post:
      tags:
        - Scheduling Service
      summary: Cria um novo agendamento (data + turno)
      operationId: createScheduling
      security:
        - bearerAuth: [ ]
      requestBody:
        description: >
          Para atualizar o check-in, inclua o campo `checkinStatus` seguindo as regras:
          administradores podem enviar CANCELADO, REALIZADO ou NAO_REALIZADO; usuarios comuns so podem enviar CANCELADO ou REALIZADO (apenas no dia agendado). Se nao for alterar o status, nao envie o campo.
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateSchedulingDto'
            example:
              userId: 1 # ID do usuario que esta criando o agendamento
              trackId: 2 # ID da pista que esta sendo agendada 
              paymentId: 3 # ID do pagamento associado (pode ser null)
              scheduledDate: "2026-01-01" # Data do agendamento
              turno: "VESPERTINO" # OPCOES: MATUTINO, VESPERTINO, NOTURNO
              # Para alterar checkinStatus inclua o campo seguindo as regras descritas no schema (admins: CANCELADO/REALIZADO/NAO_REALIZADO; usuarios: CANCELADO ou REALIZADO no dia agendado).
      responses:
        '200':
          description: Agendamento criado com sucesso
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Scheduling'
        '500':
          description: Erro interno no servidor

    put:
      tags:
        - Scheduling Service
      summary: Atualiza um agendamento existente
      operationId: updateScheduling
      security:
        - bearerAuth: [ ]
      requestBody:
        description: >
          Inclua `checkinStatus` somente para alterar o status e respeitando as mesmas regras do POST:
          admins podem definir CANCELADO, REALIZADO ou NAO_REALIZADO; usuarios podem enviar CANCELADO ou REALIZADO (no dia agendado). Para alteracoes de data/pista/turno, omita o campo.
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateSchedulingDto'
            example:
              id: 10
              userId: 1
              trackId: 2
              paymentId: null
              scheduledDate: "2025-11-11"
              turno: "MATUTINO"
              # Inclua o campo checkinStatus apenas se for alterar o status e respeite as regras de permissao (admins: CANCELADO/REALIZADO/NAO_REALIZADO; usuarios: CANCELADO ou REALIZADO no dia).
      responses:
        '200':
          description: Agendamento atualizado com sucesso
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Scheduling'
        '500':
          description: Erro interno no servidor

    get:
      tags:
        - Scheduling Service
      summary: Lista todos os agendamentos
      operationId: listSchedulings
      security:
        - bearerAuth: [ ]
      responses:
        '200':
          description: Lista de agendamentos
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Scheduling'
        '500':
          description: Erro interno no servidor

  /scheduling/{id}:
    delete:
      tags:
        - Scheduling Service
      summary: Remove um agendamento pelo ID
      operationId: deleteSchedulingById
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Agendamento removido com sucesso
        '500':
          description: Erro interno no servidor

  /scheduling/analytics/day:
    get:
      tags:
        - Scheduling Analytics
      summary: Retorna a quantidade de agendamentos por turno em um dia especifico
      operationId: getSchedulingSummaryByDay
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: date
          required: true
          schema:
            type: string
            format: date
      responses:
        '200':
          description: Totais por turno retornados com sucesso
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SchedulingDaySummary'
        '500':
          description: Erro interno no servidor

  /payment/:
    get:
      tags:
        - Payment Service
      summary: Lista todas as formas de pagamento
      operationId: listPayments
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Lista de pagamentos
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Payment'
        '500':
          description: Erro interno no servidor

  /scheduling/analytics/by-track:
    get:
      tags:
        - Scheduling Analytics
      summary: Retorna a quantidade total de agendamentos por pista
      operationId: getSchedulingSummaryByTrack
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: startDate
          required: false
          schema:
            type: string
            format: date
        - in: query
          name: endDate
          required: false
          schema:
            type: string
            format: date
      responses:
        '200':
          description: Totais por pista retornados com sucesso
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/SchedulingTrackSummary'
        '500':
          description: Erro interno no servidor

  /scheduling/analytics/by-payment:
    get:
      tags:
        - Scheduling Analytics
      summary: Retorna a quantidade total de agendamentos por forma de pagamento
      operationId: getSchedulingSummaryByPayment
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: startDate
          required: false
          schema:
            type: string
            format: date
        - in: query
          name: endDate
          required: false
          schema:
            type: string
            format: date
      responses:
        '200':
          description: Totais por pagamento retornados com sucesso
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/SchedulingPaymentSummary'
        '500':
          description: Erro interno no servidor

  /scheduling/analytics/by-user:
    get:
      tags:
        - Scheduling Analytics
      summary: Retorna o ranking de usuarios por quantidade de agendamentos
      operationId: getSchedulingSummaryByUser
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: limit
          required: false
          schema:
            type: integer
            default: 10
        - in: query
          name: startDate
          required: false
          schema:
            type: string
            format: date
        - in: query
          name: endDate
          required: false
          schema:
            type: string
            format: date
      responses:
        '200':
          description: Totais por usuario retornados com sucesso
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/SchedulingUserSummary'
        '500':
          description: Erro interno no servidor

  /scheduling/analytics/timeline:
    get:
      tags:
        - Scheduling Analytics
      summary: Retorna a quantidade de agendamentos por mes em um periodo
      operationId: getSchedulingTimeline
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: startDate
          required: false
          schema:
            type: string
            format: date
        - in: query
          name: endDate
          required: false
          schema:
            type: string
            format: date
      responses:
        '200':
          description: Timeline retornada com sucesso
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/SchedulingTimelinePoint'
        '500':
          description: Erro interno no servidor

  /scheduling/analytics/cancellations:
    get:
      tags:
        - Scheduling Analytics
      summary: Retorna o percentual de cancelamentos no periodo informado
      operationId: getSchedulingCancellationStats
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: startDate
          required: false
          schema:
            type: string
            format: date
        - in: query
          name: endDate
          required: false
          schema:
            type: string
            format: date
      responses:
        '200':
          description: Percentual de cancelamentos retornado com sucesso
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SchedulingCancellationStats'
        '500':
          description: Erro interno no servidor

  /scheduling/analytics/day-range:
    get:
      tags:
        - Scheduling Analytics
      summary: Retorna o resumo diario por turno em um intervalo
      operationId: getSchedulingSummaryByDayRange
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: startDate
          required: false
          schema:
            type: string
            format: date
        - in: query
          name: endDate
          required: false
          schema:
            type: string
            format: date
      responses:
        '200':
          description: Resumo diario retornado com sucesso
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/SchedulingDaySummary'
        '500':
          description: Erro interno no servidor

  /track/:
    get:
      tags:
        - Track Service
      summary: Lista todas as pistas
      operationId: listTracks
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Lista de pistas
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Track'
        '500':
          description: Erro interno no servidor

  /user/:
    put:
      tags:
        - User Service
      summary: Atualiza um usuario
      operationId: updateUser
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserEditDto'
      responses:
        '200':
          description: Usuario atualizado com sucesso
        '500':
          description: Erro interno no servidor
    get:
      tags:
        - User Service
      summary: Lista todos os usuarios
      operationId: listUsers
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Lista de usuarios
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/User'
        '500':
          description: Erro interno no servidor

  /user/search:
    get:
      tags:
        - User Service
      summary: Busca usuarios pelo nome
      operationId: getUserByName
      security:
        - bearerAuth: [ ]
      parameters:
        - name: name
          in: query
          required: true
          schema:
            type: string
      responses:
        '200':
          description: User found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '500':
          description: Erro interno no servidor


  /user/id/{id}:
    get:
      tags:
        - User Service
      summary: Busca um usuario pelo ID
      operationId: getUserById
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: User found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '500':
          description: Erro interno no servidor
    delete:
      tags:
        - User Service
      summary: Remove um usuario pelo ID
      operationId: deleteUserById
      security:
        - bearerAuth: [ ]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Usuario removido com sucesso
        '500':
          description: Erro interno no servidor

